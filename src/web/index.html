<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>五子棋 RL Web</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <div class="app compact">
      <main class="board-wrap compact two-col">
        <section class="board-area compact">
          <div class="board-top compact">
            <div class="title-block">
              <h1>五子棋 & AlphaZero</h1>
            </div>
            <div class="board-controls compact">
              <div class="row status">
                <label>当前局势</label>
                <div id="statusText">点击“新对局”开始。</div>
                <div class="meta" id="aiProb">AI 落子概率：暂无</div>
              </div>
            </div>
          </div>
          <canvas id="board" width="560" height="560"></canvas>
          <div class="hint">
            点击交叉点落子。橙色光晕与数字显示 AI 的落子概率；上一手会被高亮。
          </div>
          <div class="panel compact config-panel">
            <div class="row">
              <label>搜索次数</label>
              <input id="sims" type="number" min="50" max="5000" value="800" />
            </div>
            <div class="row">
              <label>设备</label>
              <div class="row-inline">
                <input id="deviceInput" type="text" value="cpu" />
                <button id="applyConfig" class="mini">应用</button>
              </div>
              <div class="meta" id="deviceInfo">服务端：cpu</div>
            </div>
            <div class="row">
              <label>AZ 模型</label>
              <div class="row-inline">
                <select id="azModelSelect"></select>
                <button id="reloadModel" class="mini">重载</button>
              </div>
              <div class="meta" id="modelInfo">模型：未加载</div>
              <div class="meta" id="modelTime">模型文件：暂无</div>
            </div>
          </div>
        </section>
        <aside class="policy-box compact analysis-panel">
          <div class="policy-title">MCTS 分解</div>
          <div class="meta mcts-note">
            pi = visits / total；PUCT = Q + U，U = c_puct * P * sqrt(N) / (1 + n)
          </div>
          <div id="mctsList" class="policy-list mcts-list mcts-placeholder"></div>
          <div class="policy-title">局势走势图</div>
          <div class="eval">
            <span id="evalText">AZ 评估：暂无</span>
            <div class="eval-chart">
              <canvas id="evalChart" width="320" height="120"></canvas>
            </div>
          </div>
          <div class="action-row" id="humanSide">
            <button id="newGame" class="cta action-btn">新对局</button>
            <button data-side="x" class="pill action-btn active">执黑（先手）</button>
            <button data-side="o" class="pill action-btn">执白（后手）</button>
            <button id="undoMove" class="mini action-btn">悔棋</button>
          </div>
          <div class="mode-row">
            <label for="analysisOnly">模式</label>
            <select id="analysisOnly">
              <option value="0">人机对战</option>
              <option value="1">人人对局（仅分析）</option>
            </select>
            <div class="meta">AI 只给出建议落子，不自动下子。</div>
          </div>
        </aside>
      </main>
    </div>

    <div id="resultModal" class="modal hidden">
      <div class="modal-card">
        <div class="modal-title" id="resultTitle">对局结束</div>
        <div class="modal-body" id="resultBody"></div>
        <div class="modal-actions">
          <button id="closeModal" class="mini">关闭</button>
          <button id="newFromModal" class="cta">新对局</button>
        </div>
      </div>
    </div>

    <div id="noticeModal" class="modal hidden" hidden>
      <div class="modal-card">
        <div class="modal-title">提示</div>
        <div class="modal-body" id="noticeBody">配置已更新，将在新对局生效。</div>
        <div class="modal-actions single">
          <button id="closeNotice" class="cta">知道了</button>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
